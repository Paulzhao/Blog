<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="PaulZhao的博客"><title>修改AppPool中的账号密码 | PaulZhao Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">修改AppPool中的账号密码</h1><a id="logo" href="/.">PaulZhao Blog</a><p class="description">Paul's Blog</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">修改AppPool中的账号密码</h1><div class="post-meta">Mar 23, 2018</div><div class="post-content"><p>最近公司的Security升级，要求将Windows中的一些Service Account修改密码，来达到增强安全。但是之前有很多的IIS和Windows Service都是用的Service Account来进行配置的，所以这些全都是需要进行更新升级的。</p>
<p>粗俗了一下，会有好几百个需要进行更新，所以还是去写一些脚本来实现这些功能吧</p>
<h2 id="更新IIS中ApplicationPool中的账号密码"><a href="#更新IIS中ApplicationPool中的账号密码" class="headerlink" title="更新IIS中ApplicationPool中的账号密码"></a>更新IIS中ApplicationPool中的账号密码</h2><p>通过查阅相关的文档，发现可以用下面的语句是实现对账号的修改</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获得当前的用户名，密码信息</span></span><br><span class="line"><span class="built_in">Get-ItemProperty</span> IIS:\AppPools\TestPool -Name processModel</span><br><span class="line"><span class="comment">#设置用户名，密码</span></span><br><span class="line"><span class="built_in">Set-ItemProperty</span> IIS:\AppPools\TestPool -Name processModel -value @&#123;userName=<span class="string">"PaulZhao"</span>;password=<span class="string">"YourPassword"</span>;identitytype=<span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>
<p>通过上面的命令 ，我们发现可以修改掉这个AppPool中的用户名和密码，对于 userName和 password属性我们都比较熟悉，但是对于IdentityType这个属性的值，我们就没用那么清楚了，不知道在什么情况下该设置成什么值，所以查阅了MSDN之后才发现了这些值分别对应什么(Link: <a href="https://docs.microsoft.com/en-us/iis/configuration/system.applicationhost/applicationpools/add/processmodel)。" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/iis/configuration/system.applicationhost/applicationpools/add/processmodel)。</a></p>
<table>
<thead>
<tr>
<th>IdentityType</th>
<th>Type Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ApplicationPoolIdentity</td>
<td>Specifies that the application pool runs under the dynamically-created application pool identity account. Starting in IIS 7.5, <code>ApplicationPoolIdentity</code> is the default identity under which to run application pools. (In IIS 7.0 the default identity was NetworkService.         When an application pool runs under the <code>ApplicationPoolIdentity</code>account, the      application pool accesses resources as the “IIS AppPool&lt;AppPool&gt;” identity. For example, for the “DefaultAppPool”, the identity is “IIS AppPool\DefaultAppPool”. This identity allows administrators to specify permissions that pertain only to the identity under which the application pool is running, thereby increasing server security.                           The numeric value is <strong>4</strong>.</td>
</tr>
<tr>
<td>LocalService</td>
<td>Specifies that the application pool runs under the built-in <strong>LocalService</strong> account, which has the same user rights as <strong>NetworkService</strong> .                                                                When an application pool runs under the <strong>LocalService</strong> account, the application pool presents anonymous credentials on the network.                                                                                                                            <strong>Note: </strong>Running an application pool under an account that has high-level user rights is a serious security risk.                                                                                                           The numeric value is <strong>1</strong></td>
</tr>
<tr>
<td>LocalSystem</td>
<td>Specifies that the application pool runs under the built-in <strong>LocalSystem</strong> account, which has extensive privileges on the local computer and acts as the computer on the network.  <strong>Note: </strong>Running an application pool under an account that has high-level user rights is a serious security risk.                                                                                                           The numeric value is <strong>0</strong>.</td>
</tr>
<tr>
<td>NetworkService</td>
<td>Specifies that the application pool runs under the built-in <strong>NetworkService</strong>account. In IIS 7.0 this was the default identity under which to run application pools; in IIS 7.5 default was changed to ApplicationPoolIdentity.                                                                                   When an application pool runs under the <strong>NetworkService</strong> account, the application pool accesses network resources as the computer account.                                                       The numeric value is <strong>2</strong>.</td>
</tr>
<tr>
<td>SpecificUser</td>
<td>Specifies that the application pool runs under a custom identity, which is configured by using the <strong>userName</strong> and <strong>password</strong> attributes.                                                             <strong>Note: </strong>To avoid storing unencrypted password strings in configuration files, always use AppCmd.exe or IIS Manager to enter passwords. If you use these management tools, the password strings will be encrypted automatically before they are written to the XML configuration files. This provides better password security than storing unencrypted passwords.                                                                                                                      <strong>Note: </strong>Managed service accounts can be used to enable services and tasks to share their own domain accounts and to enable automatic password management, eliminating the need for an administrator to manually administer passwords. For more information, see <a href="https://technet.microsoft.com/en-us/library/hh831451.aspx" target="_blank" rel="noopener">What’s New for Managed Service Accounts</a>.                                                                     The numeric value is <strong>3</strong>.</td>
</tr>
</tbody>
</table>
<p>接下来我们获取所有的ApplicationPool，然后循环来判断我们需要进行修改的那些Pool</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义数组来存储需要进行修改的账号</span></span><br><span class="line"><span class="variable">$Accounts</span> = <span class="string">'test1'</span>,<span class="string">'test2'</span>,<span class="string">'test3'</span></span><br><span class="line"><span class="comment">#获取所有的ApplicationPool</span></span><br><span class="line"><span class="variable">$Pools</span> = <span class="built_in">Get-Item</span> IIS:\AppPools</span><br><span class="line"><span class="comment">#查看Pool有哪些</span></span><br><span class="line"><span class="variable">$Pools</span>.Children</span><br><span class="line"><span class="comment">#遍历查看属性并修改</span></span><br><span class="line"><span class="variable">$Pools</span>.Children.Keys | % &#123;</span><br><span class="line">  <span class="variable">$AppPool</span> = <span class="built_in">Get-ItemProperty</span> IIS:\AppPools\<span class="variable">$_</span> -Name processModel</span><br><span class="line">  <span class="keyword">if</span>((<span class="variable">$AppPool</span>.identitytype <span class="nomarkup">-eq</span> <span class="string">"SpecificUser"</span>) -and (<span class="variable">$AppPool</span>.userName <span class="nomarkup">-in</span> <span class="variable">$Accounts</span>))&#123;</span><br><span class="line">    	<span class="built_in">Write-host</span> <span class="string">"Start modify account for AppPool <span class="variable">$_</span> identity"</span></span><br><span class="line">    	<span class="built_in">Set-ItemProperty</span> IIS:\AppPools\TestPool -Name processModel value                          @&#123;userName=<span class="string">"PaulZhao"</span>;password=<span class="string">"YourPassword"</span>;identitytype=<span class="number">3</span>&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后我们再加上机器循环，来实现远程修改</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义ComputerList</span></span><br><span class="line"><span class="variable">$ComputerList</span> = @(<span class="string">"Computer1"</span>,<span class="string">"Computer2"</span>,<span class="string">"Computer2"</span>)</span><br><span class="line"><span class="variable">$Cred</span> = <span class="built_in">Get-Credential</span></span><br><span class="line"><span class="variable">$ComputerList</span> | % &#123;</span><br><span class="line">  <span class="built_in">Invoke-Command</span> -ComputerName <span class="variable">$_</span> -Credential <span class="variable">$Cred</span> -ScriptBlock &#123;</span><br><span class="line">     <span class="built_in">import-module</span> WebAdministration</span><br><span class="line">     <span class="comment">#上面的命令</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/Powershell/">Powershell</a></div><div class="post-nav"><a class="next" href="/2018/03/21/我的第一篇文章/">我的第一篇文章</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://PaulZhao.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Powershell/" style="font-size: 15px;">Powershell</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/03/23/修改AppPool中的账号密码/">修改AppPool中的账号密码</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/21/我的第一篇文章/">我的第一篇文章</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/21/hello-world/">Hello World</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">PaulZhao Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>